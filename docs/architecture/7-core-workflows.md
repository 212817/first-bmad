# 7. Core Workflows

### 7.1 Authentication Flow

```
┌────────┐     ┌────────┐     ┌────────┐     ┌────────┐
│  User  │     │  PWA   │     │  API   │     │ Google │
└───┬────┘     └───┬────┘     └───┬────┘     └───┬────┘
    │              │              │              │
    │ Click Login  │              │              │
    │─────────────>│              │              │
    │              │              │              │
    │              │ GET /auth/google            │
    │              │─────────────>│              │
    │              │              │              │
    │              │   Redirect   │              │
    │              │<─────────────│              │
    │              │              │              │
    │         Redirect to Google consent        │
    │<─────────────────────────────────────────>│
    │              │              │              │
    │              │  Callback with code         │
    │              │─────────────>│              │
    │              │              │              │
    │              │              │ Exchange code│
    │              │              │─────────────>│
    │              │              │              │
    │              │              │ User info    │
    │              │              │<─────────────│
    │              │              │              │
    │              │ Set cookies (access+refresh)│
    │              │<─────────────│              │
    │              │              │              │
    │  Redirect to app            │              │
    │<─────────────│              │              │
```

### 7.2 Save Parking Spot Flow

```
┌────────┐     ┌────────┐     ┌────────┐     ┌────────┐     ┌────────┐
│  User  │     │  PWA   │     │  API   │     │   R2   │     │  Neon  │
└───┬────┘     └───┬────┘     └───┬────┘     └───┬────┘     └───┬────┘
    │              │              │              │              │
    │ Tap "Park"   │              │              │              │
    │─────────────>│              │              │              │
    │              │              │              │              │
    │              │ Get GPS coords              │              │
    │              │──────────────────────────────────────────> │
    │              │              │              │              │
    │              │ POST /photos/upload-url     │              │
    │              │─────────────>│              │              │
    │              │              │              │              │
    │              │ Signed URL   │              │              │
    │              │<─────────────│              │              │
    │              │              │              │              │
    │              │ PUT photo    │              │              │
    │              │─────────────────────────────>              │
    │              │              │              │              │
    │              │ POST /spots  │              │              │
    │              │─────────────>│              │              │
    │              │              │              │              │
    │              │              │ INSERT spot  │              │
    │              │              │─────────────────────────────>
    │              │              │              │              │
    │              │ 201 Created  │              │              │
    │              │<─────────────│              │              │
    │              │              │              │              │
    │ Show success │              │              │              │
    │<─────────────│              │              │              │
```

### 7.3 Navigate to Car Flow

```
┌────────┐     ┌────────┐     ┌────────┐
│  User  │     │  PWA   │     │  Maps  │
└───┬────┘     └───┬────┘     └───┬────┘
    │              │              │
    │ Tap Navigate │              │
    │─────────────>│              │
    │              │              │
    │              │ Get current location
    │              │──────────────────────────>
    │              │              │
    │              │ Build maps URL
    │              │ (dest=spot coords)
    │              │              │
    │              │ Open external
    │              │─────────────>│
    │              │              │
    │   Maps app opens with directions
    │<─────────────────────────────
```

---
