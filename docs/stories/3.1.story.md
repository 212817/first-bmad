# Story 3.1: Display Latest Spot on Home Screen

## Status

Approved

## Story

**As a** user,  
**I want** to see my most recent parking spot on the home screen,  
**so that** I can quickly navigate back without extra taps.

## Acceptance Criteria

1. Home screen shows a card with latest saved spot
2. Card displays: address (or coordinates), timestamp, car tag, photo thumbnail (if exists)
3. Card shows "Navigate" button prominently
4. If no spots saved, show empty state with prompt to save first spot
5. Latest spot updates immediately after new save
6. For guest mode, pulls from IndexedDB; for authenticated, from database

## Tasks / Subtasks

- [ ] **Task 1: Create Latest Spot Card Component** (AC: 1, 2, 3)
  - [ ] Create `apps/web/src/components/spot/LatestSpotCard.tsx`
  - [ ] Display address or formatted coordinates
  - [ ] Display relative timestamp ("2 hours ago")
  - [ ] Display car tag badge (from Story 2.7)
  - [ ] Display photo thumbnail (if exists)
  - [ ] Add prominent "Navigate" button
  - [ ] Style for mobile-first, touch-friendly

- [ ] **Task 2: Backend - Get Latest Spot Endpoint** (AC: 6)
  - [ ] Add `GET /v1/spots/latest` endpoint
  - [ ] Return most recent spot for authenticated user
  - [ ] Include all spot fields (photo, note, tag, address)
  - [ ] Return 404 if no spots exist
  - [ ] Write integration tests

- [ ] **Task 3: Update Spot Repository** (AC: 6)
  - [ ] Add `findLatestByUserId(userId)` method
  - [ ] Query with `ORDER BY savedAt DESC LIMIT 1`
  - [ ] Write unit tests

- [ ] **Task 4: Update Spot Store for Latest** (AC: 5, 6)
  - [ ] Add `latestSpot` state to spotStore
  - [ ] Add `fetchLatestSpot()` action
  - [ ] Handle auth vs guest mode routing
  - [ ] Auto-update after new spot save
  - [ ] Write unit tests

- [ ] **Task 5: Guest Mode Latest Spot** (AC: 6)
  - [ ] Add `getLatestSpot()` to IndexedDB service
  - [ ] Query spots store sorted by savedAt
  - [ ] Return most recent or null
  - [ ] Write unit tests

- [ ] **Task 6: Integrate into Home Page** (AC: 1, 5)
  - [ ] Update `HomePage.tsx` to include LatestSpotCard
  - [ ] Fetch latest spot on mount
  - [ ] Update card after new spot saved
  - [ ] Position below/above save button based on design

- [ ] **Task 7: Empty State Component** (AC: 4)
  - [ ] Create `apps/web/src/components/spot/EmptySpotState.tsx`
  - [ ] Show message: "No parking spot saved yet"
  - [ ] Include prompt: "Tap below to save your first spot"
  - [ ] Style with illustration or icon

- [ ] **Task 8: Photo Thumbnail Component** (AC: 2)
  - [ ] Create `apps/web/src/components/spot/SpotThumbnail.tsx`
  - [ ] Load photo from signed URL
  - [ ] Show placeholder while loading
  - [ ] Handle missing photo gracefully
  - [ ] Optimize for small size (lazy load)

- [ ] **Task 9: Testing**
  - [ ] Test card displays all fields
  - [ ] Test empty state shows correctly
  - [ ] Test auto-update after save
  - [ ] Test guest mode
  - [ ] Write Playwright E2E tests

## Dev Notes

### Architecture References

- [architecture-frontend/6-component-hierarchy.md](../architecture-frontend/6-component-hierarchy.md)
- [architecture/5-api-specification.md](../architecture/5-api-specification.md)

### Dependencies

- Story 2.1 (spots database and store)
- Story 2.7 (car tags display)
- Story 2.8 (address display)

### Latest Spot Card Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ…¿ï¸ My Car                     2h agoâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”                             â”‚
â”‚ â”‚photoâ”‚  Near Central Park West     â”‚
â”‚ â”‚     â”‚  New York, NY               â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         [ ğŸ§­ Navigate ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Endpoint

```bash
# Get latest spot
GET /api/v1/spots/latest
Authorization: Bearer <token>

# Response
{
  "id": "uuid",
  "lat": 40.7128,
  "lng": -74.006,
  "address": "Near Central Park West, New York",
  "photoUrl": "https://...",
  "note": "Level P2",
  "carTag": "My Car",
  "savedAt": "2026-01-15T10:00:00Z"
}

# No spots
HTTP 404
{ "error": "No spots found" }
```

### Component Implementation

```tsx
// components/spot/LatestSpotCard.tsx
interface LatestSpotCardProps {
  spot: Spot | null;
  onNavigate: () => void;
}

export function LatestSpotCard({ spot, onNavigate }: LatestSpotCardProps) {
  if (!spot) {
    return <EmptySpotState />;
  }

  return (
    <div className="bg-white rounded-xl shadow-md p-4">
      <div className="flex justify-between items-center mb-3">
        <TagBadge name={spot.carTag || 'My Car'} />
        <span className="text-sm text-gray-500">{formatRelativeTime(spot.savedAt)}</span>
      </div>

      <div className="flex gap-3 mb-4">
        {spot.photoUrl && <SpotThumbnail url={spot.photoUrl} className="w-16 h-16 rounded" />}
        <div>
          <p className="font-medium">{spot.address || formatCoords(spot.lat, spot.lng)}</p>
          {spot.note && <p className="text-sm text-gray-500">{spot.note}</p>}
        </div>
      </div>

      <button
        onClick={onNavigate}
        className="w-full h-12 bg-blue-500 text-white rounded-lg font-medium flex items-center justify-center gap-2"
      >
        <CompassIcon className="w-5 h-5" />
        Navigate
      </button>
    </div>
  );
}
```

### File Locations

**New Files:**

- `apps/web/src/components/spot/LatestSpotCard.tsx`
- `apps/web/src/components/spot/EmptySpotState.tsx`
- `apps/web/src/components/spot/SpotThumbnail.tsx`

**Modified Files:**

- `apps/api/src/routes/spots/spots.routes.ts` - add latest endpoint
- `apps/api/src/repositories/spot.repository.ts` - add findLatest
- `apps/web/src/stores/spotStore.ts` - add latestSpot state
- `apps/web/src/pages/HomePage.tsx` - integrate card

### Testing Coverage

- LatestSpotCard: 95%
- EmptySpotState: 90%
- Latest endpoint: 100%

## Change Log

| Date       | Version | Description            | Author |
| ---------- | ------- | ---------------------- | ------ |
| 2026-01-15 | 1.0     | Initial story creation | PO     |
