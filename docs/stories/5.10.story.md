# Story 5.10: Final Polish and Cross-Browser Testing

## Status

Approved

## Story

**As a** developer,  
**I want** to perform final polish and cross-browser testing,  
**so that** the app is production-ready and works consistently for all users.

## Acceptance Criteria

1. App works correctly on Chrome (desktop and mobile)
2. App works correctly on Safari (desktop and iOS)
3. App works correctly on Firefox
4. App works correctly on Edge
5. PWA installs correctly on iOS and Android
6. All UI is responsive from 320px to 1920px+ widths
7. Dark mode works consistently across all pages
8. Loading states and error states are polished
9. No console errors or warnings in production build
10. Lighthouse scores: Performance > 90, Accessibility > 90, Best Practices > 90, PWA > 90

## Tasks / Subtasks

- [ ] **Task 1: Chrome Testing** (AC: 1)
  - [ ] Test on Chrome desktop (Windows, Mac)
  - [ ] Test on Chrome Android
  - [ ] Verify all features work
  - [ ] Check DevTools for errors
  - [ ] Document any issues

- [ ] **Task 2: Safari Testing** (AC: 2)
  - [ ] Test on Safari desktop (Mac)
  - [ ] Test on Safari iOS (iPhone, iPad)
  - [ ] Verify all features work
  - [ ] Check for iOS-specific issues
  - [ ] Test PWA install flow

- [ ] **Task 3: Firefox Testing** (AC: 3)
  - [ ] Test on Firefox desktop
  - [ ] Verify all features work
  - [ ] Check DevTools for errors
  - [ ] Document any issues

- [ ] **Task 4: Edge Testing** (AC: 4)
  - [ ] Test on Edge desktop
  - [ ] Verify all features work
  - [ ] Check DevTools for errors
  - [ ] Document any issues

- [ ] **Task 5: PWA Installation Testing** (AC: 5)
  - [ ] Test install prompt on Android Chrome
  - [ ] Test Add to Home Screen on iOS Safari
  - [ ] Verify app icon appears correctly
  - [ ] Verify splash screen
  - [ ] Test offline functionality
  - [ ] Test standalone mode

- [ ] **Task 6: Responsive Design Testing** (AC: 6)
  - [ ] Test at 320px width (small phones)
  - [ ] Test at 375px width (iPhone)
  - [ ] Test at 768px width (tablet)
  - [ ] Test at 1024px width (small desktop)
  - [ ] Test at 1920px+ width (large desktop)
  - [ ] Fix any layout issues

- [ ] **Task 7: Dark Mode Polish** (AC: 7)
  - [ ] Audit all pages in dark mode
  - [ ] Fix contrast issues
  - [ ] Ensure consistent styling
  - [ ] Test system preference detection

- [ ] **Task 8: Loading and Error States** (AC: 8)
  - [ ] Add loading skeletons where missing
  - [ ] Polish loading spinners
  - [ ] Add user-friendly error messages
  - [ ] Add retry buttons on errors
  - [ ] Handle network offline state

- [ ] **Task 9: Console Cleanup** (AC: 9)
  - [ ] Remove all console.log statements
  - [ ] Fix any React warnings
  - [ ] Fix any TypeScript errors
  - [ ] Remove unused imports
  - [ ] Clean up dead code

- [ ] **Task 10: Lighthouse Audit** (AC: 10)
  - [ ] Run Lighthouse on home page
  - [ ] Run Lighthouse on map page
  - [ ] Fix Performance issues (> 90)
  - [ ] Fix Accessibility issues (> 90)
  - [ ] Fix Best Practices issues (> 90)
  - [ ] Verify PWA checklist (> 90)
  - [ ] Document final scores

- [ ] **Task 11: Final Review**
  - [ ] Review all pages visually
  - [ ] Check copy for typos
  - [ ] Verify all links work
  - [ ] Test happy paths end-to-end
  - [ ] Sign off for production

## Dev Notes

### Architecture References

- [architecture/3-frontend.md](../architecture/3-frontend.md)
- [architecture/4-pwa.md](../architecture/4-pwa.md)
- [architecture/11-security.md](../architecture/11-security.md)

### Dependencies

- All previous stories complete
- All epics validated

### Browser Support Matrix

| Browser | Version | Platform | Status |
| ------- | ------- | -------- | ------ |
| Chrome  | Latest  | Windows  | ☐      |
| Chrome  | Latest  | Mac      | ☐      |
| Chrome  | Latest  | Android  | ☐      |
| Safari  | Latest  | Mac      | ☐      |
| Safari  | Latest  | iOS      | ☐      |
| Firefox | Latest  | Windows  | ☐      |
| Firefox | Latest  | Mac      | ☐      |
| Edge    | Latest  | Windows  | ☐      |

### PWA Checklist

**iOS Specific:**

- [ ] Add to Home Screen works
- [ ] Splash screen displays correctly
- [ ] Status bar styling
- [ ] Touch icons at all sizes
- [ ] No app banner prompt (iOS limitation)

**Android Specific:**

- [ ] Install prompt appears
- [ ] App installs to home screen
- [ ] Splash screen displays
- [ ] Push notification permission (if applicable)

### Lighthouse Targets

| Category       | Target | Current |
| -------------- | ------ | ------- |
| Performance    | > 90   | ☐       |
| Accessibility  | > 90   | ☐       |
| Best Practices | > 90   | ☐       |
| SEO            | > 90   | ☐       |
| PWA            | > 90   | ☐       |

### Common Issues to Check

**Performance:**

- Image optimization (WebP, lazy loading)
- Bundle size (code splitting)
- Font loading (preload)
- CSS delivery (critical CSS)
- JavaScript execution time

**Accessibility:**

- Alt text on images
- Label associations
- Color contrast (4.5:1 minimum)
- Keyboard navigation
- Focus indicators
- Screen reader compatibility

**Best Practices:**

- HTTPS everywhere
- No deprecated APIs
- Secure cookie settings
- CSP headers
- No mixed content

### Loading State Components

```typescript
// components/LoadingSkeleton.tsx
interface SkeletonProps {
  className?: string;
}

export function Skeleton({ className }: SkeletonProps) {
  return (
    <div
      className={`animate-pulse bg-gray-200 dark:bg-gray-700 rounded ${className}`}
    />
  );
}

export function SpotCardSkeleton() {
  return (
    <div className="p-4 border rounded-lg">
      <Skeleton className="h-40 w-full mb-4" />
      <Skeleton className="h-4 w-3/4 mb-2" />
      <Skeleton className="h-4 w-1/2" />
    </div>
  );
}

export function MapSkeleton() {
  return (
    <div className="h-full w-full flex items-center justify-center bg-gray-100 dark:bg-gray-800">
      <div className="text-center">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2" />
        <p className="text-sm text-gray-500">Loading map...</p>
      </div>
    </div>
  );
}
```

### Error State Component

```typescript
// components/ErrorState.tsx
interface ErrorStateProps {
  title?: string;
  message: string;
  onRetry?: () => void;
}

export function ErrorState({
  title = "Something went wrong",
  message,
  onRetry,
}: ErrorStateProps) {
  return (
    <div className="text-center py-8">
      <div className="text-red-500 mb-4">
        <svg
          className="w-12 h-12 mx-auto"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            strokeLinecap="round"
            strokeLinejoin="round"
            strokeWidth={2}
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
          />
        </svg>
      </div>
      <h3 className="text-lg font-semibold mb-2">{title}</h3>
      <p className="text-gray-500 dark:text-gray-400 mb-4">{message}</p>
      {onRetry && (
        <button
          onClick={onRetry}
          className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          Try Again
        </button>
      )}
    </div>
  );
}
```

### Offline Detection

```typescript
// hooks/useOnlineStatus.ts
import { useSyncExternalStore } from "react";

function subscribe(callback: () => void) {
  window.addEventListener("online", callback);
  window.addEventListener("offline", callback);
  return () => {
    window.removeEventListener("online", callback);
    window.removeEventListener("offline", callback);
  };
}

function getSnapshot() {
  return navigator.onLine;
}

export function useOnlineStatus() {
  return useSyncExternalStore(subscribe, getSnapshot);
}

// Usage
function App() {
  const isOnline = useOnlineStatus();

  if (!isOnline) {
    return <OfflineBanner />;
  }

  return <MainApp />;
}
```

### Console Cleanup Commands

```bash
# Find console.log statements
grep -r "console.log" apps/web/src --include="*.ts" --include="*.tsx"

# Find console statements
grep -rE "console\.(log|warn|error|debug)" apps/web/src --include="*.ts" --include="*.tsx"
```

### File Locations

**New Files:**

- `apps/web/src/components/LoadingSkeleton.tsx`
- `apps/web/src/components/ErrorState.tsx`
- `apps/web/src/hooks/useOnlineStatus/useOnlineStatus.ts`

**Modified Files:**

- Various components for polish
- Various pages for loading/error states

### Testing Devices (Recommended)

**Physical Devices:**

- iPhone (iOS Safari)
- Android phone (Chrome)
- iPad (Safari)

**Emulators/Simulators:**

- Chrome DevTools Device Mode
- iOS Simulator (Xcode)
- Android Emulator (Android Studio)

### Testing Coverage

- E2E tests: All happy paths
- Cross-browser: Manual verification
- Lighthouse: Automated audit

## Change Log

| Date       | Version | Description            | Author |
| ---------- | ------- | ---------------------- | ------ |
| 2026-01-15 | 1.0     | Initial story creation | PO     |
