# Requirements Traceability Matrix

## Story: 1.1 - Project Setup and Deployment Pipeline

**Date**: 2026-01-16  
**Reviewer**: Quinn (Test Architect)

---

## Coverage Summary

| Metric | Count | Percentage |
|--------|-------|------------|
| **Total Requirements (ACs)** | 15 | - |
| **Fully Covered** | 3 | 20% |
| **Infrastructure (Non-testable)** | 10 | 67% |
| **CI Verified** | 2 | 13% |

> **Note**: Story 1.1 is an infrastructure/setup story. Most ACs are verified through configuration existence, CI execution, or manual deployment verification rather than unit/integration tests.

---

## Requirement Mappings

### AC1: Monorepo with pnpm workspaces (React + Node.js)

**Coverage: INFRASTRUCTURE**  
**Verification**: Configuration files exist

| Evidence Type | Location |
|--------------|----------|
| Config | `pnpm-workspace.yaml` |
| Config | `package.json` (workspaces scripts) |
| Config | `apps/web/package.json` |
| Config | `apps/api/package.json` |

---

### AC2: ESLint 9.x + Prettier configured

**Coverage: CI-VERIFIED**  
**Verification**: CI job execution

| Test Type | Description |
|-----------|-------------|
| CI Job | `.github/workflows/ci.yml::lint` |
| CI Job | `.github/workflows/ci.yml::format` |

- **Given**: Code changes in PR
- **When**: CI workflow runs
- **Then**: `pnpm lint` and `pnpm format:check` pass

---

### AC3: TypeScript 5.7.x strict mode

**Coverage: INFRASTRUCTURE**  
**Verification**: Configuration + build success

| Evidence Type | Location |
|--------------|----------|
| Config | `tsconfig.base.json` (strict: true) |
| CI Job | `.github/workflows/ci.yml::build` |

---

### AC4: Frontend deployed to Vercel (auto-deploy)

**Coverage: DEPLOYMENT-VERIFIED**  
**Verification**: Manual/external

| Evidence Type | Location |
|--------------|----------|
| Live URL | https://first-bmad.vercel.app/ |

---

### AC5: Backend deployed to Vercel serverless

**Coverage: DEPLOYMENT-VERIFIED**  
**Verification**: Manual/external

| Evidence Type | Location |
|--------------|----------|
| Config | `apps/api/vercel.json` |
| Live Endpoint | https://first-bmad.vercel.app/health |

---

### AC6: PostgreSQL on Neon via Drizzle

**Coverage: INFRASTRUCTURE + PARTIAL TEST**  
**Verification**: Config exists, health check tests DB connection

| Evidence Type | Location |
|--------------|----------|
| Config | `apps/api/drizzle.config.ts` |
| Config | `apps/api/src/config/db.ts` |
| Integration Test | `health.test.ts` (mocked DB check) |

- **Given**: API is running with DATABASE_URL configured
- **When**: GET /health is called
- **Then**: Database connectivity is verified (returns ok/error)

---

### AC7: Environment variables configured

**Coverage: INFRASTRUCTURE**  
**Verification**: Configuration files

| Evidence Type | Location |
|--------------|----------|
| Template | `.env.example` |
| Validation | `apps/api/src/config/env.ts` (Zod schema) |

---

### AC8: GET /health returns 200 OK

**Coverage: FULL**  
**Test File**: `apps/api/test/integration/health.test.ts`

| Test Case | Given-When-Then |
|-----------|-----------------|
| `should return 200 with status ok when database is healthy` | **Given**: API running, DB healthy (mocked) |
| | **When**: GET /health is called |
| | **Then**: Response status 200, body contains {api: 'ok', database: 'ok'} |

---

### AC9: Health endpoint returns proper JSON

**Coverage: FULL**  
**Test File**: `apps/api/test/integration/health.test.ts`

| Test Case | Assertion |
|-----------|-----------|
| `should return 200 with status ok` | `expect(response.body.api).toBe('ok')` |
| | `expect(response.body.database).toBe('ok')` |
| | `expect(response.body.timestamp).toBeDefined()` |

---

### AC10: Frontend displays heading + API connectivity

**Coverage: FULL**  
**Test File**: `apps/web/src/App.test.tsx`

| Test Case | Given-When-Then |
|-----------|-----------------|
| `renders the heading` | **Given**: App component mounted |
| | **When**: Render completes |
| | **Then**: H1 contains "Where Did I Park?" |

---

### AC11: README documents setup

**Coverage: INFRASTRUCTURE**  
**Verification**: Documentation exists

| Evidence Type | Location |
|--------------|----------|
| Documentation | `README.md` (247 lines) |

---

### AC12: pnpm lint and format scripts work

**Coverage: CI-VERIFIED**  
**Verification**: CI execution

| Evidence Type | Location |
|--------------|----------|
| CI Job | `.github/workflows/ci.yml::lint` |
| CI Job | `.github/workflows/ci.yml::format` |

---

### AC13: GitHub Actions CI workflow

**Coverage: INFRASTRUCTURE**  
**Verification**: Workflow file exists + executes

| Evidence Type | Location |
|--------------|----------|
| Config | `.github/workflows/ci.yml` |
| Jobs | format, lint, build, test |

---

### AC14: Branch protection on main

**Coverage: MANUAL**  
**Verification**: GitHub repository settings

---

### AC15: CI uses only free tier

**Coverage: INFRASTRUCTURE**  
**Verification**: Workflow uses only `ubuntu-latest` runners

---

## Coverage Gaps

| AC | Gap | Severity | Suggested Test |
|----|-----|----------|----------------|
| AC6 | DB connection tested with mock only | Low | Add real DB integration test in CI with test database |
| AC8 | No test for unhealthy DB response (503) | Low | Add test case for database error scenario |

---

## Test Files Summary

| File | Test Count | Coverage |
|------|------------|----------|
| `apps/api/test/integration/health.test.ts` | 1 | AC8, AC9 |
| `apps/web/src/App.test.tsx` | 1 | AC10 |

---

## Risk Assessment

| Risk Level | Requirements |
|------------|--------------|
| **Low** | All - infrastructure story with appropriate verification |

---

## Recommendations

1. **Low Priority**: Add test for health endpoint when DB is unhealthy (503 response)
2. **Future**: Consider adding smoke test for deployed endpoints in CI
3. **Future**: Add E2E test for frontend-API connectivity when Playwright is introduced

---

## Gate YAML Block

```yaml
trace:
  totals:
    requirements: 15
    full: 3
    infrastructure: 10
    ci_verified: 2
    gaps: 2
  coverage_summary: 'Infrastructure story - most ACs verified via config/CI/deployment'
  uncovered:
    - ac: 'AC8'
      reason: 'No test for unhealthy DB scenario (503)'
      severity: low
  notes: 'docs/qa/assessments/1.1-trace-20260116.md'
```

---

Trace matrix: docs/qa/assessments/1.1-trace-20260116.md
